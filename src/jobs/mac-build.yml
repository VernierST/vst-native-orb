description: >
  Build macosx86, ios, and ios-simulator

executor: mac
resource_class: macos.x86.medium.gen2

parameters:
  package-name:
    type: string
    default: ""
  install-cmake:
    type: boolean
    default: false
  install-autotools:
    type: boolean
    default: false
  vcs-fingerprint:
    type: string
    default: ""
  build-missing:
    type: boolean
    default: false

steps:
  - setup:
      vcs-fingerprint: << parameters.vcs-fingerprint >>
  - setup-macos
  - when:
      condition: << parameters.install-cmake >>
      steps:
        - setup-macos-cmake
  - when:
      condition: << parameters.install-autotools >>
      steps:
        - setup-macos-autotools
  - install-conan-and-configure
  - build:
      profile: "macosx86"
      type: "Release"
      build-missing: << parameters.build-missing >>
  - build:
      profile: "macosx86"
      type: "Debug"
      build-missing: << parameters.build-missing >>
  - build:
      profile: "ios"
      type: "Release"
      build-missing: << parameters.build-missing >>
  - build:
      profile: "ios"
      type: "Debug"
      build-missing: << parameters.build-missing >>
  - build:
      profile: "ios-simulator"
      type: "Release"
      build-missing: << parameters.build-missing >>
  - build:
      profile: "ios-simulator"
      type: "Debug"
      build-missing: << parameters.build-missing >>
  - upload:
      package-name: << parameters.package-name >>
